{"ast":null,"code":"import { PrimeIcons } from 'primeng/api';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/core\";\nimport * as i2 from \"src/app/core/services/flujo.service\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"../../shared/table/table.component\";\nimport * as i7 from \"primeng/dialog\";\nimport * as i8 from \"primeng/api\";\nimport * as i9 from \"primeng/button\";\nconst _c0 = function () {\n  return {\n    standalone: true\n  };\n};\nfunction FlujosComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\", 16);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementStart(3, \"input\", 17);\n    i0.ɵɵlistener(\"ngModelChange\", function FlujosComponent_div_19_Template_input_ngModelChange_3_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const column_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.getObjectByAction()[column_r3.key] = $event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const column_r3 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", column_r3.name, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"name\", column_r3.key)(\"ngModel\", ctx_r0.getObjectByAction()[column_r3.key])(\"ngModelOptions\", i0.ɵɵpureFunction0(5, _c0))(\"disabled\", column_r3.key === \"_id\");\n  }\n}\nfunction FlujosComponent_ng_template_20_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"p-button\", 18);\n    i0.ɵɵlistener(\"onClick\", function FlujosComponent_ng_template_20_Template_p_button_onClick_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onSubmitFlujo());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(1, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function FlujosComponent_ng_template_20_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.visibleModal = false);\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"label\", ctx_r1.label);\n  }\n}\nfunction FlujosComponent_ng_template_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"p-button\", 20);\n    i0.ɵɵlistener(\"onClick\", function FlujosComponent_ng_template_23_Template_p_button_onClick_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.onSubmitFlujo());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(1, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function FlujosComponent_ng_template_23_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.deleteModal = false);\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"label\", ctx_r2.label);\n  }\n}\nexport class FlujosComponent {\n  get getFlujos() {\n    return [...this.flujos];\n  }\n  constructor(userService, flujoService, toastr) {\n    this.userService = userService;\n    this.flujoService = flujoService;\n    this.toastr = toastr;\n    this.flujos = [];\n    this.visibleModal = false;\n    this.deleteModal = false;\n    this.label = 'Crear';\n    this.header = '';\n    this.action = '';\n    this.message = '';\n    this.messageResponse = '';\n    this.rowCreate = {\n      nombre: '',\n      tiempo_resolucion: 0,\n      departamento: ''\n    };\n    this.rowSelectedEdit = {\n      _id: '',\n      nombre: '',\n      tiempo_resolucion: 0,\n      departamento: '',\n      creador_id: '',\n      modificador_id: '',\n      actualizado_a: new Date()\n    };\n    this.rowSelectedDelete = {\n      _id: ''\n    };\n    this.columns = [{\n      name: 'Id',\n      key: '_id',\n      show: false,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Nombre',\n      key: 'nombre',\n      show: true,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Tiempo de Resolucion',\n      key: 'tiempo_resolucion',\n      show: true,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Departamento',\n      key: 'departamento',\n      show: true,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Creador',\n      key: 'creador_id',\n      show: false,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'modificador',\n      key: 'modificador_id',\n      show: false,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Creado',\n      key: 'creado_a',\n      show: true,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Actualizado',\n      key: 'actualizado_a',\n      show: true,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true\n    }, {\n      name: 'Acciones',\n      key: 'acciones',\n      show: true,\n      isAvailableOnCreation: true,\n      isAvailableOnEdit: true,\n      hasEditButton: true,\n      hasRemoveButton: true,\n      hasCreateButton: true,\n      edit: row => {\n        this.rowSelectedEdit = row;\n        this.visibleModal = true;\n        this.label = 'Guardar Cambios';\n        this.header = 'Editar grupo';\n        this.action = 'edit';\n      },\n      remove: row => {\n        this.rowSelectedDelete = row;\n        this.label = 'Eliminar';\n        this.header = 'Eliminar grupo';\n        this.action = 'delete';\n        this.message = `¿Está seguro que desea eliminar el flujo: ${row._id}?`;\n        this.deleteModal = true;\n      },\n      create: () => {\n        this.action = 'create';\n        this.visibleModal = true;\n        this.header = 'Crear Flujo';\n        this.label = 'Crear';\n      },\n      createIcon: PrimeIcons.PLUS,\n      editIcon: PrimeIcons.PENCIL,\n      removeIcon: PrimeIcons.TRASH\n    }];\n    this.columnsToDeleteByEdit = ['acciones', 'creado_a', 'actualizado_a', 'creador_id', 'modificador_id'];\n    this.columnsToDeleteByCreate = ['acciones', 'creado_a', 'actualizado_a', 'creador_id', 'modificador_id', '_id'];\n  }\n  ngOnInit() {\n    this.userService.populate();\n    this.fetchFlujos();\n  }\n  fetchFlujos() {\n    this.flujoService.getFlujos().subscribe({\n      next: response => {\n        this.flujos = this.materializeFlujos(response);\n      },\n      error: error => console.error(error)\n    });\n  }\n  createNewRecord() {\n    this.action = 'create';\n    this.visibleModal = true;\n    this.header = 'Crear flujo';\n    this.label = 'Crear';\n  }\n  filteredColums() {\n    let filteredColumns = this.columns.filter(column => column.show === true);\n    return filteredColumns;\n  }\n  materializeFlujos(flujos) {\n    const flujoMaterialized = [];\n    flujos.forEach(flujo => {\n      flujoMaterialized.push({\n        _id: flujo._id,\n        nombre: flujo.nombre,\n        tiempo_resolucion: flujo.tiempo_resolucion,\n        departamento: flujo.departamento.nombreDepartamento,\n        creador_id: flujo.creador_id,\n        modificador_id: flujo.modificador_id,\n        creado_a: new Date(flujo.creado_a).toLocaleDateString('es-ES'),\n        actualizado_a: new Date(flujo.actualizado_a).toLocaleDateString('es-ES')\n      });\n    });\n    return flujoMaterialized;\n  }\n  onSubmitFlujo() {\n    this.visibleModal = false;\n    this.deleteModal = false;\n    if (this.action === 'edit') {\n      this.flujoService.editFlujo(this.rowSelectedEdit).subscribe({\n        next: response => {\n          this.toastr.success(response.message, 'Éxito');\n        },\n        error: error => this.toastr.error(error?.error?.message, 'Error')\n      });\n      this.rowSelectedEdit = {};\n    }\n    if (this.action === 'create') {\n      this.flujoService.createFlujo(this.rowCreate).subscribe({\n        next: response => {\n          this.toastr.success(response.message, 'Éxito');\n          this.fetchFlujos();\n        }\n      });\n      this.rowCreate = {};\n    }\n    if (this.action === 'delete') {\n      this.flujoService.deleteFlujo(this.rowSelectedDelete._id).subscribe({\n        next: response => {\n          this.toastr.success(response.message, 'Éxito');\n        },\n        error: error => this.toastr.error(error?.error?.message, 'Error')\n      });\n      this.rowSelectedDelete = {};\n    }\n    this.fetchFlujos();\n  }\n  getObjectByAction() {\n    return this.action === 'edit' ? this.rowSelectedEdit : this.rowCreate;\n  }\n  getColumnsByAction() {\n    if (this.action === 'edit') {\n      return this.columns.filter(column => !this.columnsToDeleteByEdit.includes(column.key));\n    }\n    return this.columns.filter(column => !this.columnsToDeleteByCreate.includes(column.key));\n  }\n}\nFlujosComponent.ɵfac = function FlujosComponent_Factory(t) {\n  return new (t || FlujosComponent)(i0.ɵɵdirectiveInject(i1.UserService), i0.ɵɵdirectiveInject(i2.FlujoService), i0.ɵɵdirectiveInject(i3.ToastrService));\n};\nFlujosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: FlujosComponent,\n  selectors: [[\"app-flujos\"]],\n  decls: 24,\n  vars: 14,\n  consts: [[2, \"background-color\", \"#f2f2f2\"], [1, \"banner\"], [1, \"text-banner\"], [1, \"container\"], [1, \"card\", \"border-0\", \"shadow\", \"centered-page\"], [1, \"card-body\", \"p-5\"], [1, \"table-responsive-md\"], [3, \"columns\", \"data\", \"classes\"], [3, \"onClick\"], [3, \"visible\", \"transitionOptions\", \"modal\", \"header\", \"draggable\", \"visibleChange\"], [1, \"form-group\", \"p-3\", \"rounded\", 2, \"width\", \"500px\", \"background\", \"#071426\"], [1, \"container-fields\"], [1, \"d-flex\", \"flex-wrap\", \"gap-3\", \"justify-content-center\", \"align-items-center\"], [4, \"ngFor\", \"ngForOf\"], [\"pTemplate\", \"footer\"], [\"transitionOptions\", \"300ms\", 3, \"visible\", \"modal\", \"header\", \"draggable\", \"visibleChange\"], [1, \"form-label\", \"item\"], [\"type\", \"text\", 1, \"form-control\", 3, \"name\", \"ngModel\", \"ngModelOptions\", \"disabled\", \"ngModelChange\"], [\"type\", \"button\", 1, \"p-button-success\", 3, \"label\", \"onClick\"], [\"pButton\", \"\", \"type\", \"button\", \"label\", \"Cancelar\", 1, \"p-button-danger\", 3, \"click\"], [\"type\", \"button\", 1, \"p-button-danger\", 3, \"label\", \"onClick\"], [\"pButton\", \"\", \"type\", \"button\", \"label\", \"Cancelar\", 1, \"p-button-secondary\", 3, \"click\"]],\n  template: function FlujosComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelement(1, \"br\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"div\", 1)(3, \"h3\", 2);\n      i0.ɵɵtext(4, \"Flujos\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(5, \"div\", 0);\n      i0.ɵɵelement(6, \"br\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"div\", 3)(8, \"div\", 4)(9, \"div\", 5)(10, \"section\", 6);\n      i0.ɵɵelement(11, \"app-table\", 7);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"section\")(13, \"p-button\", 8);\n      i0.ɵɵlistener(\"onClick\", function FlujosComponent_Template_p_button_onClick_13_listener() {\n        return ctx.createNewRecord();\n      });\n      i0.ɵɵtext(14, \"Crear Flujo de Trabajo\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(15, \"p-dialog\", 9);\n      i0.ɵɵlistener(\"visibleChange\", function FlujosComponent_Template_p_dialog_visibleChange_15_listener($event) {\n        return ctx.visibleModal = $event;\n      });\n      i0.ɵɵelementStart(16, \"form\", 10)(17, \"section\", 11)(18, \"div\", 12);\n      i0.ɵɵtemplate(19, FlujosComponent_div_19_Template, 4, 6, \"div\", 13);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵtemplate(20, FlujosComponent_ng_template_20_Template, 2, 1, \"ng-template\", 14);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(21, \"p-dialog\", 15);\n      i0.ɵɵlistener(\"visibleChange\", function FlujosComponent_Template_p_dialog_visibleChange_21_listener($event) {\n        return ctx.deleteModal = $event;\n      });\n      i0.ɵɵtext(22);\n      i0.ɵɵtemplate(23, FlujosComponent_ng_template_23_Template, 2, 1, \"ng-template\", 14);\n      i0.ɵɵelementEnd()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(11);\n      i0.ɵɵproperty(\"columns\", ctx.filteredColums())(\"data\", ctx.getFlujos)(\"classes\", \"table table-bordered table-striped table-hover\");\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"visible\", ctx.visibleModal)(\"transitionOptions\", \"300ms\")(\"modal\", true)(\"header\", ctx.header)(\"draggable\", false);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.getColumnsByAction());\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"visible\", ctx.deleteModal)(\"modal\", true)(\"header\", ctx.header)(\"draggable\", false);\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\" \", ctx.message, \" \");\n    }\n  },\n  dependencies: [i4.NgForOf, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.NgModel, i5.NgForm, i6.TableComponent, i7.Dialog, i8.PrimeTemplate, i9.ButtonDirective, i9.Button],\n  encapsulation: 2\n});","map":{"version":3,"mappings":"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","names":["PrimeIcons","i0","ctx_r4","FlujosComponent","getFlujos","flujos","constructor","userService","flujoService","toastr","nombre","tiempo_resolucion","departamento","_id","creador_id","modificador_id","actualizado_a","Date","name","key","show","isAvailableOnCreation","isAvailableOnEdit","hasEditButton","hasRemoveButton","hasCreateButton","edit","row","rowSelectedEdit","visibleModal","label","header","action","remove","rowSelectedDelete","message","deleteModal","create","createIcon","PLUS","editIcon","PENCIL","removeIcon","TRASH","ngOnInit","populate","fetchFlujos","subscribe","next","response","materializeFlujos","error","console","createNewRecord","filteredColums","filteredColumns","columns","filter","column","flujoMaterialized","forEach","flujo","push","nombreDepartamento","creado_a","toLocaleDateString","onSubmitFlujo","editFlujo","success","createFlujo","rowCreate","deleteFlujo","getObjectByAction","getColumnsByAction","columnsToDeleteByEdit","includes","columnsToDeleteByCreate","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\nayeli\\OneDrive\\Escritorio\\service-desk\\frontend\\src\\app\\pages\\flujos\\flujos.component.ts","C:\\Users\\nayeli\\OneDrive\\Escritorio\\service-desk\\frontend\\src\\app\\pages\\flujos\\flujos.component.html"],"sourcesContent":["import { Component } from '@angular/core';\r\nimport { UserService } from 'src/app/core';\r\nimport {\r\n  Flujo,\r\n  FlujoCreate,\r\n  FlujoDelete,\r\n  FlujoEdit,\r\n  FlujoResponse,\r\n} from 'src/app/core/interfaces/flujo.interface';\r\nimport { ColumnTable } from 'src/app/core/interfaces/sidebar.links.interface';\r\nimport { FlujoService } from 'src/app/core/services/flujo.service';\r\nimport { PrimeIcons } from 'primeng/api';\r\nimport { ToastrService } from 'ngx-toastr';\r\n\r\n@Component({\r\n  selector: 'app-flujos',\r\n  templateUrl: './flujos.component.html',\r\n})\r\nexport class FlujosComponent {\r\n  private flujos: Flujo[] = [];\r\n  get getFlujos(): Flujo[] {\r\n    return [...this.flujos];\r\n  }\r\n  visibleModal: boolean = false;\r\n  deleteModal: boolean = false;\r\n  label: string = 'Crear';\r\n  header: string = '';\r\n  action: string = '';\r\n  message: string = '';\r\n  messageResponse: string = '';\r\n  rowCreate: FlujoCreate = {\r\n    nombre: '',\r\n    tiempo_resolucion: 0,\r\n    departamento: ''\r\n  };\r\n  rowSelectedEdit: FlujoEdit = {\r\n    _id: '',\r\n    nombre: '',\r\n    tiempo_resolucion: 0,\r\n    departamento: '',\r\n    creador_id: '',\r\n    modificador_id: '',\r\n    actualizado_a: new Date(),\r\n  };\r\n  rowSelectedDelete: FlujoDelete = { _id: ''};\r\n  columns: ColumnTable[] = [\r\n    {\r\n      name: 'Id',\r\n      key: '_id',\r\n      show: false,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Nombre',\r\n      key: 'nombre',\r\n      show: true,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Tiempo de Resolucion',\r\n      key: 'tiempo_resolucion',\r\n      show: true,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Departamento',\r\n      key: 'departamento',\r\n      show: true,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Creador',\r\n      key: 'creador_id',\r\n      show: false,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'modificador',\r\n      key: 'modificador_id',\r\n      show: false,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Creado',\r\n      key: 'creado_a',\r\n      show: true,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Actualizado',\r\n      key: 'actualizado_a',\r\n      show: true,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n    },\r\n    {\r\n      name: 'Acciones',\r\n      key: 'acciones',\r\n      show: true,\r\n      isAvailableOnCreation: true,\r\n      isAvailableOnEdit: true,\r\n      hasEditButton: true,\r\n      hasRemoveButton: true,\r\n      hasCreateButton: true,\r\n      edit: (row: FlujoEdit) => {\r\n        this.rowSelectedEdit = row;\r\n        this.visibleModal = true;\r\n        this.label = 'Guardar Cambios';\r\n        this.header = 'Editar grupo';\r\n        this.action = 'edit';\r\n      },\r\n      remove: (row: FlujoDelete) => {\r\n        this.rowSelectedDelete = row;\r\n        this.label = 'Eliminar';\r\n        this.header = 'Eliminar grupo';\r\n        this.action = 'delete';\r\n        this.message = `¿Está seguro que desea eliminar el flujo: ${row._id}?`;\r\n        this.deleteModal = true;\r\n      },\r\n      create: () => {\r\n        this.action = 'create';\r\n        this.visibleModal = true;\r\n        this.header = 'Crear Flujo';\r\n        this.label = 'Crear';\r\n      },\r\n      createIcon: PrimeIcons.PLUS,\r\n      editIcon: PrimeIcons.PENCIL,\r\n      removeIcon: PrimeIcons.TRASH,\r\n    },\r\n  ];\r\n  \r\n\r\n  constructor(\r\n    private userService: UserService,\r\n    private flujoService: FlujoService,\r\n    private toastr: ToastrService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.userService.populate();\r\n    this.fetchFlujos();\r\n  }\r\n\r\n  fetchFlujos(): void {\r\n    this.flujoService.getFlujos().subscribe({\r\n      next: (response) => {\r\n        this.flujos = this.materializeFlujos(response);\r\n\r\n      },\r\n      error: (error) => console.error(error),\r\n    });\r\n  }\r\n\r\n  createNewRecord(): void {\r\n    this.action = 'create';\r\n    this.visibleModal = true;\r\n    this.header = 'Crear flujo';\r\n    this.label = 'Crear';\r\n  }\r\n\r\n  filteredColums(): ColumnTable[] {\r\n    let filteredColumns = this.columns.filter((column: ColumnTable) => column.show === true);\r\n    return filteredColumns\r\n  };\r\n\r\n  materializeFlujos(flujos: FlujoResponse[]): Flujo[] {\r\n    const flujoMaterialized: Flujo[] = [];\r\n    flujos.forEach((flujo: FlujoResponse) => {\r\n      flujoMaterialized.push({\r\n        _id: flujo._id,\r\n        nombre: flujo.nombre,\r\n        tiempo_resolucion: flujo.tiempo_resolucion,\r\n        departamento: flujo.departamento.nombreDepartamento,\r\n        creador_id: flujo.creador_id,\r\n        modificador_id: flujo.modificador_id,\r\n        creado_a: new Date(flujo.creado_a).toLocaleDateString('es-ES'),\r\n        actualizado_a: new Date(flujo.actualizado_a).toLocaleDateString('es-ES'),\r\n      });\r\n    }\r\n    );\r\n    return flujoMaterialized;\r\n  }\r\n\r\n  onSubmitFlujo(): void {\r\n    this.visibleModal = false;\r\n    this.deleteModal = false;\r\n    if (this.action === 'edit') {\r\n      this.flujoService.editFlujo(this.rowSelectedEdit).subscribe({\r\n        next: (response) => {\r\n          this.toastr.success(response.message, 'Éxito');\r\n        },\r\n        error: (error) => this.toastr.error(error?.error?.message, 'Error'),\r\n      });\r\n      this.rowSelectedEdit = {} as FlujoEdit;\r\n    }\r\n    if (this.action === 'create') {\r\n      this.flujoService.createFlujo(this.rowCreate).subscribe({\r\n        next: (response) => {\r\n          this.toastr.success(response.message, 'Éxito');\r\n          this.fetchFlujos();\r\n        },\r\n      });\r\n      this.rowCreate = {} as FlujoCreate;\r\n    }\r\n    if(this.action === 'delete'){\r\n      this.flujoService.deleteFlujo(this.rowSelectedDelete._id).subscribe({\r\n        next: (response) => {\r\n          this.toastr.success(response.message, 'Éxito');\r\n        },\r\n        error: (error) => this.toastr.error(error?.error?.message, 'Error'),\r\n      });\r\n      this.rowSelectedDelete = {} as FlujoDelete;\r\n    }\r\n    this.fetchFlujos();\r\n  }\r\n\r\n  getObjectByAction(): FlujoEdit | FlujoCreate {\r\n    return this.action === 'edit'  ? this.rowSelectedEdit : this.rowCreate;\r\n  }\r\n\r\n  columnsToDeleteByEdit: string[] = ['acciones', 'creado_a', 'actualizado_a', 'creador_id', 'modificador_id'];\r\n  columnsToDeleteByCreate: string[] = ['acciones', 'creado_a', 'actualizado_a', 'creador_id', 'modificador_id', '_id'];\r\n  getColumnsByAction(): ColumnTable[] {\r\n    if(this.action === 'edit'){\r\n      return this.columns.filter((column: ColumnTable) => !this.columnsToDeleteByEdit.includes(column.key));\r\n    }\r\n    return this.columns.filter((column: ColumnTable) => !this.columnsToDeleteByCreate.includes(column.key));\r\n  }\r\n\r\n}\r\n","<div style=\"background-color:  #f2f2f2;\">\r\n  <br>\r\n </div>\r\n<div class=\"banner\">\r\n  <h3 class=\"text-banner\">Flujos</h3>\r\n</div>\r\n<div style=\"background-color:  #f2f2f2;\">\r\n  <br>\r\n </div>\r\n<div class=\"container\">\r\n  <div class=\"card border-0 shadow centered-page\">\r\n\r\n\r\n    <div class=\"card-body p-5\">     \r\n\r\n        <section class=\"table-responsive-md\">\r\n          <app-table [columns]=\"filteredColums()\" [data]=\"getFlujos\" [classes]=\"'table table-bordered table-striped table-hover'\" ></app-table>\r\n        </section>\r\n\r\n        <section>\r\n          <p-button (onClick)=\"createNewRecord()\">Crear Flujo de Trabajo</p-button>\r\n        </section>\r\n\r\n        <p-dialog\r\n          [(visible)]=\"visibleModal\"\r\n          [transitionOptions]=\"'300ms'\"\r\n          [modal]=\"true\"\r\n          [header]=\"header\"\r\n          [draggable]=\"false\"\r\n        >\r\n          <form\r\n            class=\"form-group p-3 rounded\"\r\n            style=\"width: 500px; background: #071426;\"\r\n          >\r\n            <section class=\"container-fields\">\r\n              <div\r\n                class=\"d-flex flex-wrap gap-3 justify-content-center align-items-center\"\r\n              >\r\n                <div *ngFor=\"let column of getColumnsByAction()\">\r\n                  <label class=\"form-label item\">\r\n                    {{ column.name }}\r\n                    <input\r\n                      class=\"form-control\"\r\n                      type=\"text\"\r\n                      [name]=\"column.key\"\r\n                      [(ngModel)]=\"getObjectByAction()[column.key]\"\r\n                      [ngModelOptions]=\"{ standalone: true }\"\r\n                      [disabled]=\"column.key === '_id'\"\r\n                    />\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </section>\r\n          </form>\r\n          \r\n          <ng-template pTemplate=\"footer\">\r\n            <p-button\r\n              type=\"button\"\r\n              [label]=\"label\"\r\n              class=\"p-button-success\"\r\n              (onClick)=\"onSubmitFlujo()\"\r\n            ></p-button>\r\n            <button\r\n              pButton\r\n              type=\"button\"\r\n              label=\"Cancelar\"\r\n              class=\"p-button-danger\"\r\n              (click)=\"visibleModal = false\"\r\n            ></button>\r\n          </ng-template>\r\n        </p-dialog>\r\n      \r\n        <p-dialog\r\n          [(visible)]=\"deleteModal\"\r\n          transitionOptions=\"300ms\"\r\n          [modal]=\"true\"\r\n          [header]=\"header\"\r\n          [draggable]=\"false\"\r\n        >\r\n          {{ message }}\r\n      \r\n          <ng-template pTemplate=\"footer\">\r\n            <p-button\r\n              type=\"button\"\r\n              [label]=\"label\"\r\n              class=\"p-button-danger\"\r\n              (onClick)=\"onSubmitFlujo()\"\r\n            ></p-button>\r\n            <button\r\n              pButton\r\n              type=\"button\"\r\n              label=\"Cancelar\"\r\n              class=\"p-button-secondary\"\r\n              (click)=\"deleteModal= false\"\r\n            ></button>\r\n          </ng-template>\r\n        </p-dialog>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}