{"ast":null,"code":"import { forkJoin } from 'rxjs';\nimport { saveAs } from 'file-saver';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/core/services/history.tickets.service\";\nimport * as i2 from \"ngx-toastr\";\nimport * as i3 from \"src/app/shared/loading\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"primeng/api\";\nimport * as i6 from \"primeng/button\";\nimport * as i7 from \"primeng/calendar\";\nimport * as i8 from \"primeng/table\";\nimport * as i9 from \"primeng/panel\";\nfunction ReportingComponent_ng_template_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 22)(1, \"th\");\n    i0.ɵɵtext(2, \"Ticket Id\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"th\");\n    i0.ɵɵtext(4, \"Creador\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Asignado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Creado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Completado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Tiempo Estimado Resolucion\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14, \"Tiempo Resolucion Horas de Negocio\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\");\n    i0.ɵɵtext(16, \"Tiempo Real Resolucion\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"th\");\n    i0.ɵɵtext(18, \"SLA\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ReportingComponent_ng_template_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 22)(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 23);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\", 24);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 23);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\", 23);\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\", 25);\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const data_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.ticketId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.email_creador);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.asignado);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.fechaCreacion);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.fechaCompletado);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.tiempoEstimadoResolucion);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.tiempoResolucionHorasOficina);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.tiempoRealResolucion);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(data_r4.percentageSLA);\n  }\n}\nfunction ReportingComponent_ng_template_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 22)(1, \"th\");\n    i0.ɵɵtext(2, \"Ticket Id\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"th\");\n    i0.ɵɵtext(4, \"Creador\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\", 26);\n    i0.ɵɵtext(6, \"Asignado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Creado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Completado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Departamento\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14, \"Tiempo Real Resolucion\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ReportingComponent_ng_template_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 22)(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 23);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 23);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\", 23);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const dataByDepto_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.ticketId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.email_creador);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.asignado);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.fechaCreacion);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.fechaCompletado);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.nombreDepartamento);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dataByDepto_r5.tiempoRealResolucion);\n  }\n}\nexport class ReportingComponent {\n  constructor(historyService, toastrt, loadingService) {\n    this.historyService = historyService;\n    this.toastrt = toastrt;\n    this.loadingService = loadingService;\n    this.data = [];\n    this.dataByDepto = [];\n  }\n  exportToCsv(data, fileName) {\n    const separator = ',';\n    const keys = Object.keys(data[0]);\n    const csvContent = keys.join(separator) + '\\n' + data.map(row => {\n      return keys.map(k => {\n        let cell = row[k] === null || row[k] === undefined ? '' : row[k];\n        cell = cell instanceof Date ? cell.toLocaleString() : cell.toString();\n        cell = cell.replace(/\"/g, '\"\"');\n        return '\"' + cell + '\"';\n      }).join(separator);\n    }).join('\\n');\n    const blob = new Blob([csvContent], {\n      type: 'text/csv;charset=utf-8;'\n    });\n    saveAs(blob, fileName + '.csv');\n  }\n  exportTicketReport() {\n    if (this.data.length === 0) {\n      this.toastrt.error('Debe de generar un reporte para poder descargar los reportes.', 'Error');\n    }\n    this.exportToCsv(this.data, `tickets-reporte_${new Date().toLocaleString()}`);\n  }\n  exportTicketByDepartmentReport() {\n    if (this.dataByDepto.length === 0) {\n      this.toastrt.error('Debe de generar un reporte para poder descargar los reportes.', 'Error');\n    }\n    this.exportToCsv(this.dataByDepto, `tickets-por-departamento_${new Date().toLocaleString()}`);\n  }\n  onGenerateReport(event) {\n    event.preventDefault();\n    this.loadingService.setLoading(true);\n    const reportRequest = {\n      dateStart: this.dateStart,\n      dateEnd: this.dateEnd\n    };\n    if (this.dateStart == undefined || this.dateEnd == undefined) {\n      this.loadingService.setLoading(false);\n      this.toastrt.error('Debe de ingresar la fecha de inicio y fin.', 'Error');\n      return;\n    }\n    const reportTickets$ = this.historyService.getReportTickets(reportRequest);\n    const reportTicketsByDepto$ = this.historyService.getReportTicketsByDepto(reportRequest);\n    this.destroySubscription$ = forkJoin([reportTickets$, reportTicketsByDepto$]).subscribe({\n      next: ([reportTicketsResponse, reportTicketsByDeptoResponse]) => {\n        this.data = reportTicketsResponse;\n        this.dataByDepto = reportTicketsByDeptoResponse;\n        this.loadingService.setLoading(false);\n      },\n      error: error => {\n        this.toastrt.error('No se pudieron cagar los datos', 'Error');\n        this.loadingService.setLoading(false);\n      }\n    });\n  }\n  ngOnDestroy() {\n    if (this.destroySubscription$) {\n      this.destroySubscription$.unsubscribe();\n    }\n  }\n}\nReportingComponent.ɵfac = function ReportingComponent_Factory(t) {\n  return new (t || ReportingComponent)(i0.ɵɵdirectiveInject(i1.HistoryTicketsService), i0.ɵɵdirectiveInject(i2.ToastrService), i0.ɵɵdirectiveInject(i3.LoadingService));\n};\nReportingComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ReportingComponent,\n  selectors: [[\"app-reporting\"]],\n  decls: 33,\n  vars: 14,\n  consts: [[2, \"background-color\", \"#f2f2f2\"], [1, \"banner\"], [1, \"text-banner\"], [1, \"container\", 2, \"overflow\", \"visible\"], [1, \"card\", \"border-0\", \"shadow\", \"centered-page\"], [1, \"card-body\", \"p-3\", \"overflow-auto\", 2, \"height\", \"67%\"], [1, \"reporting-container\"], [1, \"header-container-filters\"], [1, \"d-flex\", \"flex-column\"], [\"inputId\", \"time\", \"appendTo\", \"body\", \"placeholder\", \"Fecha Inicio\", 3, \"ngModel\", \"showTime\", \"showSeconds\", \"ngModelChange\"], [\"inputId\", \"time\", \"appendTo\", \"body\", \"placeholder\", \"Fecha Final\", 3, \"ngModel\", \"showTime\", \"showSeconds\", \"ngModelChange\"], [1, \"d-flex\", \"justify-content-end\", \"align-items-end\"], [\"pButton\", \"\", \"pRipple\", \"\", \"type\", \"button\", \"label\", \"Generar Reporte\", 1, \"p-button-raised\", \"p-button-info\", 3, \"click\"], [1, \"mt-2\", \"overflow-auto\"], [\"header\", \"Por Tickets\", \"styleClass\", \"mb-3\", 3, \"toggleable\"], [3, \"value\", \"paginator\", \"rows\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [1, \"d-flex\", \"justify-content-center\", \"align-items-end\", 2, \"padding-top\", \"1rem\"], [\"pButton\", \"\", \"pRipple\", \"\", \"type\", \"button\", \"label\", \"Descargar\", 1, \"p-button-raised\", \"p-button-info\", 3, \"click\"], [\"header\", \"Por Departamentos\", 3, \"toggleable\"], [1, \"\"], [2, \"font-size\", \"small\"], [2, \"width\", \"150px\"], [2, \"width\", \"170px\"], [2, \"width\", \"100px\"], [2, \"width\", \"130px\"]],\n  template: function ReportingComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelement(1, \"br\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"div\", 1)(3, \"h3\", 2);\n      i0.ɵɵtext(4, \"Reportes\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(5, \"div\", 0);\n      i0.ɵɵelement(6, \"br\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"div\", 3)(8, \"div\", 4)(9, \"div\", 5)(10, \"main\", 6)(11, \"header\", 7)(12, \"div\", 8)(13, \"p-calendar\", 9);\n      i0.ɵɵlistener(\"ngModelChange\", function ReportingComponent_Template_p_calendar_ngModelChange_13_listener($event) {\n        return ctx.dateStart = $event;\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(14, \"div\", 8)(15, \"p-calendar\", 10);\n      i0.ɵɵlistener(\"ngModelChange\", function ReportingComponent_Template_p_calendar_ngModelChange_15_listener($event) {\n        return ctx.dateEnd = $event;\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(16, \"div\", 11)(17, \"button\", 12);\n      i0.ɵɵlistener(\"click\", function ReportingComponent_Template_button_click_17_listener($event) {\n        return ctx.onGenerateReport($event);\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(18, \"section\", 13)(19, \"p-panel\", 14)(20, \"div\")(21, \"p-table\", 15);\n      i0.ɵɵtemplate(22, ReportingComponent_ng_template_22_Template, 19, 0, \"ng-template\", 16);\n      i0.ɵɵtemplate(23, ReportingComponent_ng_template_23_Template, 19, 9, \"ng-template\", 17);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(24, \"div\", 18)(25, \"button\", 19);\n      i0.ɵɵlistener(\"click\", function ReportingComponent_Template_button_click_25_listener() {\n        return ctx.exportTicketReport();\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(26, \"p-panel\", 20)(27, \"div\", 21)(28, \"p-table\", 15);\n      i0.ɵɵtemplate(29, ReportingComponent_ng_template_29_Template, 15, 0, \"ng-template\", 16);\n      i0.ɵɵtemplate(30, ReportingComponent_ng_template_30_Template, 15, 7, \"ng-template\", 17);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(31, \"div\", 18)(32, \"button\", 19);\n      i0.ɵɵlistener(\"click\", function ReportingComponent_Template_button_click_32_listener() {\n        return ctx.exportTicketByDepartmentReport();\n      });\n      i0.ɵɵelementEnd()()()()()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(13);\n      i0.ɵɵproperty(\"ngModel\", ctx.dateStart)(\"showTime\", true)(\"showSeconds\", true);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngModel\", ctx.dateEnd)(\"showTime\", true)(\"showSeconds\", true);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"toggleable\", true);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"value\", ctx.data)(\"paginator\", true)(\"rows\", 5);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"toggleable\", true);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"value\", ctx.dataByDepto)(\"paginator\", true)(\"rows\", 4);\n    }\n  },\n  dependencies: [i4.NgControlStatus, i4.NgModel, i5.PrimeTemplate, i6.ButtonDirective, i7.Calendar, i8.Table, i9.Panel],\n  styles: [\".header-container-filters[_ngcontent-%COMP%]  {\\r\\n  display: grid;\\r\\n  grid-template-columns: 20% 20% 56.7%;\\r\\n  gap: 1rem;\\r\\n} \\r\\n\\r\\n.card-body-container[_ngcontent-%COMP%] {\\r\\n  height: 40rem;\\r\\n}\\r\\n\\r\\n.tabset-styles[_ngcontent-%COMP%] {\\r\\n  height: 39rem;\\r\\n}\\r\\n\\r\\n[_nghost-%COMP%]   nb-tab[_ngcontent-%COMP%] {\\r\\n  padding: 1.25rem;\\r\\n}\\r\\n.reporting-container[_ngcontent-%COMP%] {\\r\\n  margin: 0 auto;\\r\\n  max-width: 1400px;\\r\\n}\\r\\n\\r\\n@media (max-width: 1490px) {\\r\\n  .tables-container[_ngcontent-%COMP%]{\\r\\n    display: grid;\\r\\n    grid-template-columns: repeat(2, 1fr);\\r\\n    gap: 1rem;\\r\\n    overflow: scroll;  \\r\\n  }\\r\\n\\r\\n  .reporting-container[_ngcontent-%COMP%] {\\r\\n    margin: 1rem 1.5rem;\\r\\n    overflow-y: scroll;\\r\\n    height: 85vh; \\r\\n  }\\r\\n}\\r\\n\\r\\n.card-body[_ngcontent-%COMP%]::-webkit-scrollbar {\\r\\n  -webkit-appearance: none;\\r\\n}\\r\\n\\r\\n.card-body[_ngcontent-%COMP%]::-webkit-scrollbar:vertical {\\r\\n  width:15px;\\r\\n}\\r\\n\\r\\n.card-body[_ngcontent-%COMP%]::-webkit-scrollbar-button:increment, .card-body[_ngcontent-%COMP%]::-webkit-scrollbar-button {\\r\\n  display: none;\\r\\n} \\r\\n\\r\\n.card-body[_ngcontent-%COMP%]::-webkit-scrollbar:horizontal {\\r\\n  height: 10px;\\r\\n}\\r\\n\\r\\n.card-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb {\\r\\n  background-color: #797979;\\r\\n  border-radius: 20px;\\r\\n  border: 2px solid #f1f2f3;\\r\\n}\\r\\n\\r\\n.card-body[_ngcontent-%COMP%]::-webkit-scrollbar-track {\\r\\n  border-radius: 10px;  \\r\\n}\\r\\n\\r\\n.label-dates[_ngcontent-%COMP%] {\\r\\n  font-weight: 700;\\r\\n  text-transform: capitalize;\\r\\n  font-size: 1.125rem;\\r\\n  line-height: 1.75rem;\\r\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcGFnZXMvcmVwb3J0aW5nL3JlcG9ydGluZy5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsYUFBYTtFQUNiLG9DQUFvQztFQUNwQyxTQUFTO0FBQ1g7O0FBRUE7RUFDRSxhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxnQkFBZ0I7QUFDbEI7QUFDQTtFQUNFLGNBQWM7RUFDZCxpQkFBaUI7QUFDbkI7O0FBRUE7RUFDRTtJQUNFLGFBQWE7SUFDYixxQ0FBcUM7SUFDckMsU0FBUztJQUNULGdCQUFnQjtFQUNsQjs7RUFFQTtJQUNFLG1CQUFtQjtJQUNuQixrQkFBa0I7SUFDbEIsWUFBWTtFQUNkO0FBQ0Y7O0FBRUE7RUFDRSx3QkFBd0I7QUFDMUI7O0FBRUE7RUFDRSxVQUFVO0FBQ1o7O0FBRUE7RUFDRSxhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxZQUFZO0FBQ2Q7O0FBRUE7RUFDRSx5QkFBeUI7RUFDekIsbUJBQW1CO0VBQ25CLHlCQUF5QjtBQUMzQjs7QUFFQTtFQUNFLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQiwwQkFBMEI7RUFDMUIsbUJBQW1CO0VBQ25CLG9CQUFvQjtBQUN0QiIsInNvdXJjZXNDb250ZW50IjpbIi5oZWFkZXItY29udGFpbmVyLWZpbHRlcnMgIHtcclxuICBkaXNwbGF5OiBncmlkO1xyXG4gIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMjAlIDIwJSA1Ni43JTtcclxuICBnYXA6IDFyZW07XHJcbn0gXHJcblxyXG4uY2FyZC1ib2R5LWNvbnRhaW5lciB7XHJcbiAgaGVpZ2h0OiA0MHJlbTtcclxufVxyXG5cclxuLnRhYnNldC1zdHlsZXMge1xyXG4gIGhlaWdodDogMzlyZW07XHJcbn1cclxuXHJcbjpob3N0IG5iLXRhYiB7XHJcbiAgcGFkZGluZzogMS4yNXJlbTtcclxufVxyXG4ucmVwb3J0aW5nLWNvbnRhaW5lciB7XHJcbiAgbWFyZ2luOiAwIGF1dG87XHJcbiAgbWF4LXdpZHRoOiAxNDAwcHg7XHJcbn1cclxuXHJcbkBtZWRpYSAobWF4LXdpZHRoOiAxNDkwcHgpIHtcclxuICAudGFibGVzLWNvbnRhaW5lcntcclxuICAgIGRpc3BsYXk6IGdyaWQ7XHJcbiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpO1xyXG4gICAgZ2FwOiAxcmVtO1xyXG4gICAgb3ZlcmZsb3c6IHNjcm9sbDsgIFxyXG4gIH1cclxuXHJcbiAgLnJlcG9ydGluZy1jb250YWluZXIge1xyXG4gICAgbWFyZ2luOiAxcmVtIDEuNXJlbTtcclxuICAgIG92ZXJmbG93LXk6IHNjcm9sbDtcclxuICAgIGhlaWdodDogODV2aDsgXHJcbiAgfVxyXG59XHJcblxyXG4uY2FyZC1ib2R5Ojotd2Via2l0LXNjcm9sbGJhciB7XHJcbiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lO1xyXG59XHJcblxyXG4uY2FyZC1ib2R5Ojotd2Via2l0LXNjcm9sbGJhcjp2ZXJ0aWNhbCB7XHJcbiAgd2lkdGg6MTVweDtcclxufVxyXG5cclxuLmNhcmQtYm9keTo6LXdlYmtpdC1zY3JvbGxiYXItYnV0dG9uOmluY3JlbWVudCwuY2FyZC1ib2R5Ojotd2Via2l0LXNjcm9sbGJhci1idXR0b24ge1xyXG4gIGRpc3BsYXk6IG5vbmU7XHJcbn0gXHJcblxyXG4uY2FyZC1ib2R5Ojotd2Via2l0LXNjcm9sbGJhcjpob3Jpem9udGFsIHtcclxuICBoZWlnaHQ6IDEwcHg7XHJcbn1cclxuXHJcbi5jYXJkLWJvZHk6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjNzk3OTc5O1xyXG4gIGJvcmRlci1yYWRpdXM6IDIwcHg7XHJcbiAgYm9yZGVyOiAycHggc29saWQgI2YxZjJmMztcclxufVxyXG5cclxuLmNhcmQtYm9keTo6LXdlYmtpdC1zY3JvbGxiYXItdHJhY2sge1xyXG4gIGJvcmRlci1yYWRpdXM6IDEwcHg7ICBcclxufVxyXG5cclxuLmxhYmVsLWRhdGVzIHtcclxuICBmb250LXdlaWdodDogNzAwO1xyXG4gIHRleHQtdHJhbnNmb3JtOiBjYXBpdGFsaXplO1xyXG4gIGZvbnQtc2l6ZTogMS4xMjVyZW07XHJcbiAgbGluZS1oZWlnaHQ6IDEuNzVyZW07XHJcbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"mappings":"AAIA,SAAuBA,QAAQ,QAAQ,MAAM;AAE7C,SAASC,MAAM,QAAQ,YAAY;;;;;;;;;;;;;ICwBjBC,8BAA8B;IACxBA,yBAAS;IAAAA,iBAAK;IAClBA,0BAAI;IAAAA,uBAAO;IAAAA,iBAAK;IAChBA,0BAAI;IAAAA,wBAAQ;IAAAA,iBAAK;IACjBA,0BAAI;IAAAA,sBAAM;IAAAA,iBAAK;IACfA,0BAAI;IAAAA,2BAAU;IAAAA,iBAAK;IACnBA,2BAAI;IAAAA,2CAA0B;IAAAA,iBAAK;IACnCA,2BAAI;IAAAA,mDAAkC;IAAAA,iBAAK;IAC3CA,2BAAI;IAAAA,uCAAsB;IAAAA,iBAAK;IAC/BA,2BAAI;IAAAA,oBAAG;IAAAA,iBAAK;;;;;IAIdA,8BAA8B;IACxBA,YAAiB;IAAAA,iBAAK;IAC1BA,8BAA0B;IAAAA,YAAsB;IAAAA,iBAAK;IACrDA,0BAAI;IAAAA,YAAiB;IAAAA,iBAAK;IAC1BA,0BAAI;IAAAA,YAAsB;IAAAA,iBAAK;IAC/BA,0BAAI;IAAAA,aAAwB;IAAAA,iBAAK;IACjCA,+BAA0B;IAAAA,aAAiC;IAAAA,iBAAK;IAChEA,+BAAyB;IAAAA,aAAqC;IAAAA,iBAAK;IACnEA,+BAAyB;IAAAA,aAA6B;IAAAA,iBAAK;IAC3DA,+BAA0B;IAAAA,aAAsB;IAAAA,iBAAK;;;;IARjDA,eAAiB;IAAjBA,sCAAiB;IACKA,eAAsB;IAAtBA,2CAAsB;IAC5CA,eAAiB;IAAjBA,sCAAiB;IACjBA,eAAsB;IAAtBA,2CAAsB;IACtBA,eAAwB;IAAxBA,6CAAwB;IACFA,eAAiC;IAAjCA,sDAAiC;IAClCA,eAAqC;IAArCA,0DAAqC;IACrCA,eAA6B;IAA7BA,kDAA6B;IAC5BA,eAAsB;IAAtBA,2CAAsB;;;;;IAclDA,8BAA8B;IACxBA,yBAAS;IAAAA,iBAAK;IAClBA,0BAAI;IAAAA,uBAAO;IAAAA,iBAAK;IAChBA,8BAA0B;IAAAA,wBAAQ;IAAAA,iBAAK;IACvCA,0BAAI;IAAAA,sBAAM;IAAAA,iBAAK;IACfA,0BAAI;IAAAA,2BAAU;IAAAA,iBAAK;IACnBA,2BAAI;IAAAA,6BAAY;IAAAA,iBAAK;IACrBA,2BAAI;IAAAA,uCAAsB;IAAAA,iBAAK;;;;;IAIjCA,8BAA8B;IACxBA,YAAwB;IAAAA,iBAAK;IACjCA,8BAA0B;IAAAA,YAA6B;IAAAA,iBAAK;IAC5DA,8BAA0B;IAAAA,YAAwB;IAAAA,iBAAK;IACvDA,0BAAI;IAAAA,YAA6B;IAAAA,iBAAK;IACtCA,0BAAI;IAAAA,aAA+B;IAAAA,iBAAK;IACxCA,2BAAI;IAAAA,aAAkC;IAAAA,iBAAK;IAC3CA,+BAAyB;IAAAA,aAAoC;IAAAA,iBAAK;;;;IAN9DA,eAAwB;IAAxBA,6CAAwB;IACFA,eAA6B;IAA7BA,kDAA6B;IAC7BA,eAAwB;IAAxBA,6CAAwB;IAC9CA,eAA6B;IAA7BA,kDAA6B;IAC7BA,eAA+B;IAA/BA,oDAA+B;IAC/BA,eAAkC;IAAlCA,uDAAkC;IACbA,eAAoC;IAApCA,yDAAoC;;;ADvEjF,OAAM,MAAOC,kBAAkB;EAM7BC,YACUC,cAAqC,EACrCC,OAAsB,EACtBC,cAA8B;IAF9B,mBAAc,GAAdF,cAAc;IACd,YAAO,GAAPC,OAAO;IACP,mBAAc,GAAdC,cAAc;IALxB,SAAI,GAAqB,EAAE;IAC3B,gBAAW,GAAqB,EAAE;EAM/B;EAEHC,WAAW,CAACC,IAAW,EAAEC,QAAgB;IACvC,MAAMC,SAAS,GAAG,GAAG;IACrB,MAAMC,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACH,IAAI,CAAC,CAAC,CAAC,CAAC;IACjC,MAAMK,UAAU,GAAGF,IAAI,CAACG,IAAI,CAACJ,SAAS,CAAC,GAAG,IAAI,GAAGF,IAAI,CAACO,GAAG,CAACC,GAAG,IAAG;MAC9D,OAAOL,IAAI,CAACI,GAAG,CAACE,CAAC,IAAG;QAClB,IAAIC,IAAI,GAAGF,GAAG,CAACC,CAAC,CAAC,KAAK,IAAI,IAAID,GAAG,CAACC,CAAC,CAAC,KAAKE,SAAS,GAAG,EAAE,GAAGH,GAAG,CAACC,CAAC,CAAC;QAChEC,IAAI,GAAGA,IAAI,YAAYE,IAAI,GAAGF,IAAI,CAACG,cAAc,EAAE,GAAGH,IAAI,CAACI,QAAQ,EAAE;QACrEJ,IAAI,GAAGA,IAAI,CAACK,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC;QAC/B,OAAO,GAAG,GAAGL,IAAI,GAAG,GAAG;MACzB,CAAC,CAAC,CAACJ,IAAI,CAACJ,SAAS,CAAC;IACpB,CAAC,CAAC,CAACI,IAAI,CAAC,IAAI,CAAC;IAEb,MAAMU,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACZ,UAAU,CAAC,EAAE;MAAEa,IAAI,EAAE;IAAyB,CAAE,CAAC;IACxE1B,MAAM,CAACwB,IAAI,EAAEf,QAAQ,GAAG,MAAM,CAAC;EACjC;EAEAkB,kBAAkB;IAChB,IAAG,IAAI,CAACnB,IAAI,CAACoB,MAAM,KAAK,CAAC,EAAC;MACxB,IAAI,CAACvB,OAAO,CAACwB,KAAK,CAAC,+DAA+D,EAAE,OAAO,CAAC;;IAE9F,IAAI,CAACtB,WAAW,CAAC,IAAI,CAACC,IAAI,EAAE,mBAAoB,IAAIY,IAAI,EAAE,CAAEC,cAAc,EAAE,EAAE,CAAC;EACjF;EAEAS,8BAA8B;IAC5B,IAAG,IAAI,CAACC,WAAW,CAACH,MAAM,KAAK,CAAC,EAAC;MAC/B,IAAI,CAACvB,OAAO,CAACwB,KAAK,CAAC,+DAA+D,EAAE,OAAO,CAAC;;IAE9F,IAAI,CAACtB,WAAW,CAAC,IAAI,CAACwB,WAAW,EAAE,4BAA6B,IAAIX,IAAI,EAAE,CAAEC,cAAc,EAAE,EAAE,CAAC;EACjG;EAEAW,gBAAgB,CAACC,KAAU;IACzBA,KAAK,CAACC,cAAc,EAAE;IACtB,IAAI,CAAC5B,cAAc,CAAC6B,UAAU,CAAC,IAAI,CAAC;IACpC,MAAMC,aAAa,GAAkB;MACnCC,SAAS,EAAE,IAAI,CAACA,SAAS;MACzBC,OAAO,EAAE,IAAI,CAACA;KACf;IAED,IAAG,IAAI,CAACD,SAAS,IAAIlB,SAAS,IAAI,IAAI,CAACmB,OAAO,IAAInB,SAAS,EAAE;MAC3D,IAAI,CAACb,cAAc,CAAC6B,UAAU,CAAC,KAAK,CAAC;MACrC,IAAI,CAAC9B,OAAO,CAACwB,KAAK,CAAC,4CAA4C,EAAE,OAAO,CAAC;MAEzE;;IAEF,MAAMU,cAAc,GAAG,IAAI,CAACnC,cAAc,CAACoC,gBAAgB,CAACJ,aAAa,CAAC;IAC1E,MAAMK,qBAAqB,GAAG,IAAI,CAACrC,cAAc,CAACsC,uBAAuB,CAACN,aAAa,CAAC;IAExF,IAAI,CAACO,oBAAoB,GAAG5C,QAAQ,CAAC,CACnCwC,cAAc,EACdE,qBAAqB,CACtB,CAAC,CAACG,SAAS,CACV;MACEC,IAAI,EAAE,CAAC,CAACC,qBAAqB,EAAEC,4BAA4B,CAAC,KAAI;QAC9D,IAAI,CAACvC,IAAI,GAAGsC,qBAAqB;QACjC,IAAI,CAACf,WAAW,GAAGgB,4BAA4B;QAC/C,IAAI,CAACzC,cAAc,CAAC6B,UAAU,CAAC,KAAK,CAAC;MACvC,CAAC;MACDN,KAAK,EAAGA,KAAK,IAAI;QACf,IAAI,CAACxB,OAAO,CAACwB,KAAK,CAAC,gCAAgC,EAAE,OAAO,CAAC;QAC7D,IAAI,CAACvB,cAAc,CAAC6B,UAAU,CAAC,KAAK,CAAC;MACvC;KACD,CACF;EACH;EAEAa,WAAW;IACT,IAAI,IAAI,CAACL,oBAAoB,EAAE;MAC7B,IAAI,CAACA,oBAAoB,CAACM,WAAW,EAAE;;EAE3C;;AAlFW/C,kBAAkB;mBAAlBA,kBAAkB;AAAA;AAAlBA,kBAAkB;QAAlBA,kBAAkB;EAAAgD;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MCb/BrD,8BAAyC;MACvCA,qBAAI;MACLA,iBAAM;MACPA,8BAAoB;MACMA,wBAAQ;MAAAA,iBAAK;MAEvCA,8BAAyC;MACvCA,qBAAI;MACLA,iBAAM;MACPA,8BAAkD;MAM1BA;QAAA;MAAA,EAAuB;MAAkGA,iBAAa;MAEpJA,+BAAgC;MAClBA;QAAA;MAAA,EAAqB;MAAiGA,iBAAa;MAEjJA,gCAAwD;MAEpDA;QAAA,OAASsD,4BAAwB;MAAA,EAAC;MAACtD,iBAAS;MAGlDA,oCAAoC;MAI5BA,uFAYc;MACdA,uFAYc;MAChBA,iBAAU;MAEZA,gCAAsF;MAElFA;QAAA,OAASsD,wBAAoB;MAAA,EAAC;MAACtD,iBAAS;MAG9CA,oCAAwD;MAGlDA,uFAUc;MACdA,uFAUc;MAChBA,iBAAU;MAEZA,gCAAsF;MAElFA;QAAA,OAASsD,oCAAgC;MAAA,EAAC;MAACtD,iBAAS;;;MA5E5CA,gBAAuB;MAAvBA,uCAAuB;MAGvBA,eAAqB;MAArBA,qCAAqB;MAQaA,eAAmB;MAAnBA,iCAAmB;MAEtDA,eAAc;MAAdA,gCAAc;MAkCSA,eAAmB;MAAnBA,iCAAmB;MAE1CA,eAAqB;MAArBA,uCAAqB","names":["forkJoin","saveAs","i0","ReportingComponent","constructor","historyService","toastrt","loadingService","exportToCsv","data","fileName","separator","keys","Object","csvContent","join","map","row","k","cell","undefined","Date","toLocaleString","toString","replace","blob","Blob","type","exportTicketReport","length","error","exportTicketByDepartmentReport","dataByDepto","onGenerateReport","event","preventDefault","setLoading","reportRequest","dateStart","dateEnd","reportTickets$","getReportTickets","reportTicketsByDepto$","getReportTicketsByDepto","destroySubscription$","subscribe","next","reportTicketsResponse","reportTicketsByDeptoResponse","ngOnDestroy","unsubscribe","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\nayeli\\OneDrive\\Escritorio\\service-desk\\frontend\\src\\app\\pages\\reporting\\reporting.component.ts","C:\\Users\\nayeli\\OneDrive\\Escritorio\\service-desk\\frontend\\src\\app\\pages\\reporting\\reporting.component.html"],"sourcesContent":["import { Component } from '@angular/core';\r\nimport { ToastrService } from 'ngx-toastr';\r\nimport { ReportRequest, ReportResponse } from 'src/app/core/interfaces/report.interface';\r\nimport { HistoryTicketsService } from 'src/app/core/services/history.tickets.service';\r\nimport { Subscription, forkJoin } from 'rxjs';\r\nimport { LoadingService } from 'src/app/shared/loading';\r\nimport { saveAs } from 'file-saver';\r\n\r\n@Component({\r\n  selector: 'app-reporting',\r\n  templateUrl: './reporting.component.html',\r\n  styleUrls: ['./reporting.component.css'],\r\n})\r\nexport class ReportingComponent {\r\n  private destroySubscription$: Subscription;\r\n  dateStart: Date;\r\n  dateEnd: Date;\r\n  data: ReportResponse[] = [];\r\n  dataByDepto: ReportResponse[] = [];\r\n  constructor(\r\n    private historyService: HistoryTicketsService,\r\n    private toastrt: ToastrService,\r\n    private loadingService: LoadingService,\r\n\r\n  ) {}\r\n\r\n  exportToCsv(data: any[], fileName: string) {\r\n    const separator = ',';\r\n    const keys = Object.keys(data[0]);\r\n    const csvContent = keys.join(separator) + '\\n' + data.map(row => {\r\n      return keys.map(k => {\r\n        let cell = row[k] === null || row[k] === undefined ? '' : row[k];\r\n        cell = cell instanceof Date ? cell.toLocaleString() : cell.toString();\r\n        cell = cell.replace(/\"/g, '\"\"');\r\n        return '\"' + cell + '\"';\r\n      }).join(separator);\r\n    }).join('\\n');\r\n\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    saveAs(blob, fileName + '.csv');\r\n  }\r\n\r\n  exportTicketReport(){\r\n    if(this.data.length === 0){\r\n      this.toastrt.error('Debe de generar un reporte para poder descargar los reportes.', 'Error'); \r\n    }\r\n    this.exportToCsv(this.data, `tickets-reporte_${(new Date()).toLocaleString()}`);\r\n  }\r\n\r\n  exportTicketByDepartmentReport(){\r\n    if(this.dataByDepto.length === 0){\r\n      this.toastrt.error('Debe de generar un reporte para poder descargar los reportes.', 'Error'); \r\n    }\r\n    this.exportToCsv(this.dataByDepto, `tickets-por-departamento_${(new Date()).toLocaleString()}`);\r\n  }\r\n\r\n  onGenerateReport(event: any) {\r\n    event.preventDefault();\r\n    this.loadingService.setLoading(true);\r\n    const reportRequest: ReportRequest = {\r\n      dateStart: this.dateStart,\r\n      dateEnd: this.dateEnd,\r\n    };\r\n\r\n    if(this.dateStart == undefined || this.dateEnd == undefined) {\r\n      this.loadingService.setLoading(false); \r\n      this.toastrt.error('Debe de ingresar la fecha de inicio y fin.', 'Error'); \r\n\r\n      return;\r\n    } \r\n    const reportTickets$ = this.historyService.getReportTickets(reportRequest);\r\n    const reportTicketsByDepto$ = this.historyService.getReportTicketsByDepto(reportRequest);\r\n\r\n    this.destroySubscription$ = forkJoin([\r\n      reportTickets$,\r\n      reportTicketsByDepto$,\r\n    ]).subscribe(\r\n      {\r\n        next: ([reportTicketsResponse, reportTicketsByDeptoResponse]) => {\r\n          this.data = reportTicketsResponse;\r\n          this.dataByDepto = reportTicketsByDeptoResponse;\r\n          this.loadingService.setLoading(false);\r\n        },\r\n        error: (error) => {\r\n          this.toastrt.error('No se pudieron cagar los datos', 'Error'); \r\n          this.loadingService.setLoading(false); \r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.destroySubscription$) {\r\n      this.destroySubscription$.unsubscribe();\r\n    }\r\n  }\r\n\r\n\r\n}\r\n","<div style=\"background-color:  #f2f2f2;\">\r\n  <br>\r\n </div>\r\n<div class=\"banner\">\r\n  <h3 class=\"text-banner\">Reportes</h3>\r\n</div>\r\n<div style=\"background-color:  #f2f2f2;\">\r\n  <br>\r\n </div>\r\n<div class=\"container\" style=\"overflow: visible;\">\r\n  <div class=\"card border-0 shadow centered-page\">\r\n    <div class=\"card-body p-3 overflow-auto\" style=\"height: 67%;\">\r\n      <main class=\"reporting-container\">\r\n        <header class=\"header-container-filters\">\r\n          <div class=\"d-flex flex-column\">\r\n            <p-calendar [(ngModel)]=\"dateStart\" [showTime]=\"true\" [showSeconds]=\"true\" inputId=\"time\" appendTo=\"body\" placeholder=\"Fecha Inicio\"></p-calendar>\r\n          </div>\r\n          <div class=\"d-flex flex-column\">\r\n            <p-calendar [(ngModel)]=\"dateEnd\" [showTime]=\"true\" [showSeconds]=\"true\" inputId=\"time\" appendTo=\"body\" placeholder=\"Fecha Final\"></p-calendar>\r\n          </div>\r\n          <div class=\"d-flex justify-content-end align-items-end\">\r\n            <button pButton pRipple type=\"button\" label=\"Generar Reporte\" class=\"p-button-raised p-button-info\"\r\n              (click)=\"onGenerateReport($event)\"></button>\r\n          </div>\r\n        </header>\r\n        <section class=\"mt-2 overflow-auto\">\r\n          <p-panel header=\"Por Tickets\" styleClass=\"mb-3\" [toggleable]=\"true\">\r\n            <div>\r\n              <p-table [value]=\"data\" [paginator]=\"true\" [rows]=\"5\">\r\n                <ng-template pTemplate=\"header\">\r\n                  <tr style=\"font-size: small;\">\r\n                    <th>Ticket Id</th>\r\n                    <th>Creador</th>\r\n                    <th>Asignado</th>\r\n                    <th>Creado</th>\r\n                    <th>Completado</th>\r\n                    <th>Tiempo Estimado Resolucion</th>\r\n                    <th>Tiempo Resolucion Horas de Negocio</th>\r\n                    <th>Tiempo Real Resolucion</th>\r\n                    <th>SLA</th>\r\n                  </tr>\r\n                </ng-template>\r\n                <ng-template pTemplate=\"body\" let-data>\r\n                  <tr style=\"font-size: small;\">\r\n                    <td>{{data.ticketId}}</td>\r\n                    <td style=\"width: 150px;\">{{data.email_creador}}</td>\r\n                    <td>{{data.asignado}}</td>\r\n                    <td>{{data.fechaCreacion}}</td>\r\n                    <td>{{data.fechaCompletado}}</td>\r\n                    <td style=\"width: 170px;\">{{data.tiempoEstimadoResolucion}}</td>\r\n                    <td style=\"width: 150px\">{{data.tiempoResolucionHorasOficina}}</td>\r\n                    <td style=\"width: 150px\">{{data.tiempoRealResolucion}}</td>\r\n                    <td style=\"width: 100px;\">{{data.percentageSLA}}</td>\r\n                  </tr>\r\n                </ng-template>\r\n              </p-table>\r\n            </div>\r\n            <div class=\"d-flex justify-content-center align-items-end\" style=\"padding-top: 1rem;\">\r\n              <button pButton pRipple type=\"button\" label=\"Descargar\" class=\"p-button-raised p-button-info\"\r\n                (click)=\"exportTicketReport()\"></button>\r\n            </div>\r\n          </p-panel>\r\n          <p-panel header=\"Por Departamentos\" [toggleable]=\"true\">\r\n            <div class=\"\">\r\n              <p-table [value]=\"dataByDepto\" [paginator]=\"true\" [rows]=\"4\">\r\n                <ng-template pTemplate=\"header\">\r\n                  <tr style=\"font-size: small;\">\r\n                    <th>Ticket Id</th>\r\n                    <th>Creador</th>\r\n                    <th style=\"width: 130px;\">Asignado</th>\r\n                    <th>Creado</th>\r\n                    <th>Completado</th>\r\n                    <th>Departamento</th>\r\n                    <th>Tiempo Real Resolucion</th>\r\n                  </tr>\r\n                </ng-template>\r\n                <ng-template pTemplate=\"body\" let-dataByDepto>\r\n                  <tr style=\"font-size: small;\">\r\n                    <td>{{dataByDepto.ticketId}}</td>\r\n                    <td style=\"width: 150px;\">{{dataByDepto.email_creador}}</td>\r\n                    <td style=\"width: 150px;\">{{dataByDepto.asignado}}</td>\r\n                    <td>{{dataByDepto.fechaCreacion}}</td>\r\n                    <td>{{dataByDepto.fechaCompletado}}</td>\r\n                    <td>{{dataByDepto.nombreDepartamento}}</td>\r\n                    <td style=\"width: 150px\">{{dataByDepto.tiempoRealResolucion}}</td>\r\n                  </tr>\r\n                </ng-template>\r\n              </p-table>\r\n            </div>\r\n            <div class=\"d-flex justify-content-center align-items-end\" style=\"padding-top: 1rem;\">\r\n              <button pButton pRipple type=\"button\" label=\"Descargar\" class=\"p-button-raised p-button-info\"\r\n                (click)=\"exportTicketByDepartmentReport()\"></button>\r\n            </div>\r\n          </p-panel>\r\n        </section>\r\n      </main>\r\n    </div>\r\n  </div>\r\n</div>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}